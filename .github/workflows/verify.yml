name: verify
on:
  push:
    branches:
      - master
  pull_request:
  workflow_dispatch:

jobs:
  test:
    strategy:
      matrix:
        runner: ["linux.2xlarge", "windows.2xlarge"]
    runs-on: ${{ matrix.runner }}
    steps:
      - name: Download large file
        shell: bash
        run: |
          mkdir -p artifacts/nested
          rm -rf artifacts-dl
          curl -fL -o artifacts/nested/chungo-artifact.whl https://download.pytorch.org/whl/cu111/torch-1.8.1%2Bcu111-cp39-cp39-win_amd64.whl
      - uses: seemethere/upload-artifact@9d7ceb0ab39c2c88d93ef7792b27425b27d59162
        name: Upload large artifacts
        with:
          name: test-artifacts-${{ matrix.runner }}
          path: artifacts
          retention-days: 3
          if-no-files-found: error
      - uses: seemethere/download-artifact@0504774707cbc8603d7dca922e8026eb8bf3b47b
        name: Download large artifacts
        with:
          name: test-artifacts-${{ matrix.runner }}
          path: artifacts-dl
      - uses: seemethere/upload-artifact@9d7ceb0ab39c2c88d93ef7792b27425b27d59162
        name: Upload artifacts .github
        with:
          name: test-artifacts-github-${{ matrix.runner }}
          path: .github
          retention-days: 3
          if-no-files-found: error
      - uses: seemethere/download-artifact@0504774707cbc8603d7dca922e8026eb8bf3b47b
        name: Download artifacts .github
        with:
          name: test-artifacts-github-${{ matrix.runner }}
          path: .github-dl
      - name: Unzip artifact
        run: |
          unzip artifacts-dl/nested/chungo-artifact.whl
          ls .github-dl
